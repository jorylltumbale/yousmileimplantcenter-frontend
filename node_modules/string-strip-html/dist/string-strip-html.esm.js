/**
 * @name string-strip-html
 * @fileoverview Strips HTML tags from strings. No parser, accepts mixed sources.
 * @version 11.1.0
 * @author Roy Revelt, Codsen Ltd
 * @license MIT
 * {@link https://codsen.com/os/string-strip-html/}
 */

import j from"lodash.isplainobject";import X from"lodash.trim";import oe from"lodash.without";import{decode as ee}from"html-entities";import{rApply as re}from"ranges-apply";import{Ranges as ue}from"ranges-push";import{right as y}from"string-left-right";function K(t){return/[-_A-Za-z0-9]/.test(t)}function M(t,c){if(!t)return[];if(Array.isArray(t))return t.filter(D=>typeof D=="string"&&D.trim());if(typeof t=="string")return t.trim()?[t]:[];throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_03] ${c} must be array containing zero or more strings or something falsey. Currently it's equal to: ${t}, that a type of ${typeof t}.`)}function ae(t,c,D,b){for(let d=c,p=t.length;d<p;d++){if(t.startsWith(D,d))return!0;if(t.startsWith(b,d))return!1}return!1}function _(t,c,D){return!t||!t.quotes||!ae(c,D+1,t.quotes.value,">")}var W=new Set(["!doctype","abbr","address","area","article","aside","audio","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","doctype","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","param","picture","pre","progress","rb","rp","rt","rtc","ruby","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","ul","var","video","wbr","xml"]),P=new Set(["a","b","i","p","q","s","u"]),v=new Set([".",",",";","!","?"]),G=new Set([".",",","?",";",")","\u2026",'"',"\xBB"]),Q=new Set(["a","abbr","acronym","audio","b","bdi","bdo","big","button","canvas","cite","code","data","datalist","del","dfn","em","embed","i","iframe","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"]);var Z="11.1.0";var De=Z,F={ignoreTags:[],ignoreTagsWithTheirContents:[],onlyStripTags:[],stripTogetherWithTheirContents:["script","style","xml"],skipHtmlDecoding:!1,trimOnlySpaces:!1,stripRecognisedHTMLOnly:!1,dumpLinkHrefsNearby:{enabled:!1,putOnNewLine:!1,wrapHeads:"",wrapTails:""},cb:null};function ge(t,c){let D=Date.now(),b=[],d=[],p=[],m=[],n={};function ne(){n={attributes:[]}}ne();let V=null,w=null,a={},h={tagName:"",hrefValue:"",openingTagEnds:void 0},E="",B=!1,C=null,I=!0;function te(e){return e!=null}function le(e){return typeof e=="string"}function H(e,o,l){if(Array.isArray(o.stripTogetherWithTheirContents)&&(o.stripTogetherWithTheirContents.includes(n.name)||o.stripTogetherWithTheirContents.includes("*")))if(n.slashPresent&&Array.isArray(b)&&b.some(i=>i.name===n.name)){for(let i=b.length;i--;)if(b[i].name===n.name){m=m.filter(([$,g])=>($<b[i].lastOpeningBracketAt||$>=e+1)&&(g<=b[i].lastOpeningBracketAt||g>e+1));let r=e+1;n.lastClosingBracketAt&&(r=n.lastClosingBracketAt+1),m.push([b[i].lastOpeningBracketAt,r]),G.has(t[e])&&o.cb?o.cb({tag:n,deleteFrom:b[i].lastOpeningBracketAt,deleteTo:e+1,insert:null,rangesArr:l,proposedReturn:[b[i].lastOpeningBracketAt,e,null]}):o.cb&&o.cb({tag:n,deleteFrom:b[i].lastOpeningBracketAt,deleteTo:e,insert:"",rangesArr:l,proposedReturn:[b[i].lastOpeningBracketAt,e,""]}),b.splice(i,1);break}}else n.slashPresent||b.push(n);else Array.isArray(o.ignoreTagsWithTheirContents)&&x(e,o,n)&&(I=!1)}function R(e,o,l,i,r,$){if(Array.isArray(u.current())&&typeof l=="number"&&u.current()[0][0]===0&&u.current()[0][1]>=l)return"";if(t.length===i&&$&&(!s.dumpLinkHrefsNearby||!s.dumpLinkHrefsNearby.enabled))return null;let g="";if(Number.isInteger(l)&&l<r&&(g+=e.slice(l,r)),Number.isInteger(i)&&i>$+1){let S=e.slice($+1,i);i&&!y(t,i-1)&&(S=S.trimEnd()),S.includes(`
`)&&T(i,e)?g+=" ":g+=S}let f=!G.has(e[o]),N=e[i-1]!==">"||!e[l].trim(),z=!['"',"("].includes(e[r-1]),se=![";",".",":","!"].includes(e[o]);if((f||N&&z&&se)&&(N||z)&&e[o]!=="!"&&(!Q.has(n.name)||typeof l=="number"&&l<r||typeof i=="number"&&i>$+1)){let S=g.match(/\n/g);return Array.isArray(S)&&S.length?S.length===1?`
`:S.length===2?`

`:`


`:" "}return""}function q(e,o){if(e.dumpLinkHrefsNearby.enabled&&h.tagName&&h.tagName===n.name&&n.lastOpeningBracketAt&&(h.openingTagEnds&&n.lastOpeningBracketAt>h.openingTagEnds||!h.openingTagEnds)&&(B=!0),B){let l=e.dumpLinkHrefsNearby.putOnNewLine?`

`:"";E=`${l}${h.hrefValue}`,(typeof o!="number"||y(t,o-1))&&(E+=l)}}function T(e,o){return o?o[e]==="<"&&o[e+1]!=="%":t[e]==="<"&&t[e+1]!=="%"}function k(e){return t[e]===">"&&t[e-1]!=="%"}function x(e,o,l){if(o.ignoreTagsWithTheirContents.includes("*"))return!0;let i=t.indexOf(`<${l.name}`,e),r=t.indexOf(`</${l.name}`,e);return!l.slashPresent&&r===-1||l.slashPresent&&!d.some($=>$.name===l.name)||r>-1&&i>-1&&i<r?!1:o.ignoreTagsWithTheirContents.includes(l.name)}if(typeof t!="string")throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_01] Input must be string! Currently it's: ${(typeof t).toLowerCase()}, equal to:
${JSON.stringify(t,null,4)}`);if(c&&!j(c))throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_02] Optional Options Object must be a plain object! Currently it's: ${(typeof c).toLowerCase()}, equal to:
${JSON.stringify(c,null,4)}`);function U(){B&&(h={tagName:"",hrefValue:"",openingTagEnds:void 0},B=!1)}let s={...F,...c};if(Object.prototype.hasOwnProperty.call(s,"returnRangesOnly"))throw new TypeError("string-strip-html/stripHtml(): [THROW_ID_03] resolvedOpts.returnRangesOnly has been removed from the API since v.5 release.");s.ignoreTags=M(s.ignoreTags,"resolvedOpts.ignoreTags"),s.onlyStripTags=M(s.onlyStripTags,"resolvedOpts.onlyStripTags");let Y=!!s.onlyStripTags.length;if(s.onlyStripTags.length&&s.ignoreTags.length&&(s.onlyStripTags=oe(s.onlyStripTags,...s.ignoreTags)),j(s.dumpLinkHrefsNearby)||(s.dumpLinkHrefsNearby={...F.dumpLinkHrefsNearby}),s.dumpLinkHrefsNearby=F.dumpLinkHrefsNearby,c&&Object.prototype.hasOwnProperty.call(c,"dumpLinkHrefsNearby")&&te(c.dumpLinkHrefsNearby)){if(j(c.dumpLinkHrefsNearby))s.dumpLinkHrefsNearby={...F.dumpLinkHrefsNearby,...c.dumpLinkHrefsNearby};else if(c.dumpLinkHrefsNearby)throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_04] Optional Options Object's key dumpLinkHrefsNearby was set to ${typeof c.dumpLinkHrefsNearby}, equal to ${JSON.stringify(c.dumpLinkHrefsNearby,null,4)}. The only allowed value is a plain object. See the API reference.`)}s.stripTogetherWithTheirContents?typeof s.stripTogetherWithTheirContents=="string"&&s.stripTogetherWithTheirContents.length&&(s.stripTogetherWithTheirContents=[s.stripTogetherWithTheirContents]):s.stripTogetherWithTheirContents=[];let J={};if(s.stripTogetherWithTheirContents&&Array.isArray(s.stripTogetherWithTheirContents)&&s.stripTogetherWithTheirContents.length&&!s.stripTogetherWithTheirContents.every((e,o)=>typeof e!="string"?(J.el=e,J.i=o,!1):!0))throw new TypeError(`string-strip-html/stripHtml(): [THROW_ID_05] Optional Options Object's key stripTogetherWithTheirContents was set to contain not just string elements! For example, element at index ${J.i} has a value ${J.el} which is not string but ${(typeof J.el).toLowerCase()}.`);s.cb||(s.cb=({rangesArr:e,proposedReturn:o})=>{o&&e.push(...o)});let u=new ue({limitToBeAddedWhitespace:!0,limitLinebreaksCount:2});if(!s.skipHtmlDecoding)for(;t!==ee(t,{scope:"strict"});)t=ee(t,{scope:"strict"});let L=!1,A=!1;for(let e=0,o=t.length;e<o;e++){if(Object.keys(n).length>1&&n.lastClosingBracketAt&&n.lastClosingBracketAt<e&&t[e]!==" "&&C===null&&(C=e),!L&&t[e]==="%"&&t[e-1]==="{"&&t.includes("%}",e+1)){let l=t.indexOf("%}",e)-1;if(l>e){e=l;continue}}if(!L&&k(e)&&(!n||Object.keys(n).length<2)&&e>1){for(let l=e;l--;)if(t[l-1]===void 0||k(l)){let i=t[l-1]===void 0?l:l+1,r=t.slice(i,e+1);if(t!==`<${X(r.trim(),"/>")}>`&&[...W].some($=>X(r.trim().split(/\s+/).filter(g=>g.trim()).filter((g,f)=>f===0),"/>").toLowerCase()===$)&&ge(`<${r.trim()}>`,s).result===""){(!p.length||p[p.length-1][0]!==n.lastOpeningBracketAt)&&p.push([i,e+1]),(!m.length||m[m.length-1][0]!==n.lastOpeningBracketAt)&&m.push([i,e+1]);let $=R(t,e,i,e+1,i,e+1),g=e+1;if(t[g]&&!t[g].trim()){for(let f=g;f<o;f++)if(t[f].trim()){g=f;break}}s.cb({tag:n,deleteFrom:i,deleteTo:g,insert:$,rangesArr:u,proposedReturn:[i,g,$]})}break}}if(!A&&t[e]==="/"&&!n.quotes?.value&&Number.isInteger(n.lastOpeningBracketAt)&&!Number.isInteger(n.lastClosingBracketAt)&&(n.slashPresent=e),t[e]==='"'||t[e]==="'")if(!A&&n.nameStarts&&n.quotes&&n.quotes.value&&n.quotes.value===t[e]){a.valueEnds=e,a.value=t.slice(a.valueStarts,e),n.attributes.push(a),a={},delete n.quotes;let l;s.dumpLinkHrefsNearby.enabled&&n.attributes.some(i=>{if(typeof i.name=="string"&&i.name.toLowerCase()==="href")return l=`${s.dumpLinkHrefsNearby.wrapHeads||""}${i.value}${s.dumpLinkHrefsNearby.wrapTails||""}`,!0})&&(h={tagName:n.name,hrefValue:l,openingTagEnds:void 0})}else!A&&!n.quotes&&n.nameStarts&&(n.quotes={},n.quotes.value=t[e],n.quotes.start=e,a.nameStarts&&a.nameEnds&&a.nameEnds<e&&a.nameStarts<e&&!a.valueStarts&&(a.name=t.slice(a.nameStarts,a.nameEnds)));if(n.nameStarts!==void 0&&n.nameEnds===void 0&&(!t[e].trim()||!K(t[e]))){if(n.nameEnds=e,n.name=t.slice(n.nameStarts,n.nameEnds+(!k(e)&&t[e]!=="/"&&t[e+1]===void 0?1:0)),t[n.nameStarts-1]!=="!"&&!n.name.replace(/-/g,"").length||/^\d+$/.test(n.name[0])){n={};continue}if(typeof n.name=="string"&&n.name.toLowerCase()==="doctype"&&(A=!0),T(e)){q(s);let l=R(t,e,n.leftOuterWhitespace,e,n.lastOpeningBracketAt,e);(s.stripTogetherWithTheirContents.includes(n.name)||s.stripTogetherWithTheirContents.includes("*"))&&(m=m.filter(([i,r])=>!(i===n.leftOuterWhitespace&&r===e))),s.cb({tag:n,deleteFrom:n.leftOuterWhitespace,deleteTo:e,insert:`${l}${E}${l}`,rangesArr:u,proposedReturn:[n.leftOuterWhitespace,e,`${l}${E}${l}`]}),U(),H(e,s,u)}}if(n.quotes?.start&&n.quotes.start<e&&!n.quotes.end&&a.nameEnds&&a.equalsAt&&!a.valueStarts&&(a.valueStarts=e),!n.quotes&&a.nameEnds&&t[e]==="="&&!a.valueStarts&&!a.equalsAt&&(a.equalsAt=e),!n.quotes&&a.nameStarts&&a.nameEnds&&!a.valueStarts&&t[e].trim()&&t[e]!=="="&&(n.attributes.push(a),a={}),!n.quotes&&a.nameStarts&&!a.nameEnds&&(A&&`'"`.includes(t[a.nameStarts])?a.nameStarts<e&&t[e]===t[a.nameStarts]&&(a.nameEnds=e+1,a.name=t.slice(a.nameStarts,a.nameEnds)):t[e].trim()?t[e]==="="?a.equalsAt||(a.nameEnds=e,a.equalsAt=e,a.name=t.slice(a.nameStarts,a.nameEnds)):t[e]==="/"||k(e)?(a.nameEnds=e,a.name=t.slice(a.nameStarts,a.nameEnds),n.attributes.push(a),a={}):T(e)&&(a.nameEnds=e,a.name=t.slice(a.nameStarts,a.nameEnds),n.attributes.push(a),a={}):(a.nameEnds=e,a.name=t.slice(a.nameStarts,a.nameEnds))),!n.quotes&&n.nameEnds<e&&!t[e-1].trim()&&t[e].trim()&&!"<>/!".includes(t[e])&&!a.nameStarts&&!n.lastClosingBracketAt&&(a.nameStarts=e),n.lastOpeningBracketAt!==null&&n.lastOpeningBracketAt<e&&t[e]==="/"&&n.onlyPlausible&&(n.onlyPlausible=!1),n.lastOpeningBracketAt!==null&&n.lastOpeningBracketAt<e&&t[e]!=="/"&&(n.onlyPlausible===void 0&&((!t[e].trim()||T(e))&&!n.slashPresent?n.onlyPlausible=!0:n.onlyPlausible=!1),t[e].trim()&&n.nameStarts===void 0&&!T(e)&&t[e]!=="/"&&!k(e)&&t[e]!=="!"&&(n.nameStarts=e,n.nameContainsLetters=!1)),n.nameStarts&&!n.quotes&&typeof t[e]=="string"&&t[e].toLowerCase()!==t[e].toUpperCase()&&(n.nameContainsLetters=!0),k(e)&&_(n,t,e)&&!0&&n.lastOpeningBracketAt!==void 0&&(n.lastClosingBracketAt=e,C=null,Object.keys(a).length&&(n.attributes.push(a),a={}),s.dumpLinkHrefsNearby.enabled&&h.tagName&&!h.openingTagEnds&&(h.openingTagEnds=e)),(!A||t[e]===">")&&n.lastOpeningBracketAt!==void 0){if(n.lastClosingBracketAt===void 0){if(n.lastOpeningBracketAt<e&&!T(e)&&(t[e+1]===void 0||T(e+1))&&n.nameContainsLetters&&typeof n.nameStarts=="number"){if(n.name=t.slice(n.nameStarts,n.nameEnds||e+1).toLowerCase(),(!p.length||p[p.length-1][0]!==n.lastOpeningBracketAt)&&p.push([n.lastOpeningBracketAt,e+1]),s.ignoreTags.includes(n.name)||x(e,s,n)||!W.has(n.name)&&(n.onlyPlausible||s.stripRecognisedHTMLOnly)){n={},a={};continue}if((W.has(n.name)||P.has(n.name))&&(n.onlyPlausible===!1||n.onlyPlausible===!0&&n.attributes.length)||t[e+1]===void 0){q(s);let l=R(t,e,n.leftOuterWhitespace,e+1,n.lastOpeningBracketAt,n.lastClosingBracketAt);L&&n.name==="script"&&n.slashPresent&&(L=!1);let i;l===null||E===null?i=null:i=`${l}${E}${l}`,s.cb({tag:n,deleteFrom:n.leftOuterWhitespace,deleteTo:e+1,insert:i,rangesArr:u,proposedReturn:[n.leftOuterWhitespace,e+1,i]}),U(),H(e,s,u)}if(!m.length||m[m.length-1][0]!==n.lastOpeningBracketAt&&m[m.length-1][1]!==e+1)if(s.stripTogetherWithTheirContents.includes(n.name)||s.stripTogetherWithTheirContents.includes("*")){let l;for(let i=b.length;i--;)b[i].name===n.name&&(l=b[i]);l?(m=m.filter(([i])=>i!==l.lastOpeningBracketAt),m.push([l.lastOpeningBracketAt,e+1])):m.push([n.lastOpeningBracketAt,e+1])}else m.push([n.lastOpeningBracketAt,e+1])}}else if(e>n.lastClosingBracketAt&&t[e].trim()||t[e+1]===void 0){let l=n.lastClosingBracketAt===e?e+1:e;s.trimOnlySpaces&&l===o-1&&C!==null&&C<e&&(l=C),(!p.length||p[p.length-1][0]!==n.lastOpeningBracketAt)&&p.push([n.lastOpeningBracketAt,n.lastClosingBracketAt+1]);let i=s.ignoreTags.includes(n.name),r=x(e,s,n);if(!I||s.stripRecognisedHTMLOnly&&typeof n.name=="string"&&!W.has(n.name.toLowerCase())&&!P.has(n.name.toLowerCase())||!Y&&(i||r)||Y&&!s.onlyStripTags.includes(n.name)){if(r)if(n.slashPresent){for(let $=d.length;$--;)if(d[$].name===n.name){d.splice($,1);break}d.length||(I=!0)}else I&&(I=!1),d.push(n);s.cb({tag:n,deleteFrom:null,deleteTo:null,insert:null,rangesArr:u,proposedReturn:null}),n={},a={}}else if(!n.onlyPlausible||n.attributes.length===0&&n.name&&(W.has(n.name.toLowerCase())||P.has(n.name.toLowerCase()))||n.attributes?.some($=>$.equalsAt)){(!m.length||m[m.length-1][0]!==n.lastOpeningBracketAt)&&m.push([n.lastOpeningBracketAt,n.lastClosingBracketAt+1]);let $=R(t,e,n.leftOuterWhitespace,l,n.lastOpeningBracketAt,n.lastClosingBracketAt);E="",B=!1,q(s,l);let g;le(E)&&E.length?(g=`${$}${E}${$===`

`?`
`:$}`,l===n.lastClosingBracketAt+1&&(!t[l]||!v.has(t[l]))&&(g+=" "),n.leftOuterWhitespace===n.lastOpeningBracketAt&&u.last()&&u.last()[1]<n.lastOpeningBracketAt&&(!s.dumpLinkHrefsNearby||!s.dumpLinkHrefsNearby.putOnNewLine||!v.has(t[l]))&&(g=" "+g)):g=$,g!==null&&(n.leftOuterWhitespace===0||!y(t,l-1))&&!s.dumpLinkHrefsNearby?.enabled&&(g=void 0);let f=0;if(B&&v.has(t[l])){console.log("2345"),s.dumpLinkHrefsNearby.putOnNewLine&&(console.log(`2348 bring ${t[l]} forward from index ${l} to ${n.leftOuterWhitespace}`),g=`${t[l]}${g}`);let N=y(t,l);N&&g?.endsWith(`
`)?f+=N-e:(!N||N>e)&&f++}s.cb({tag:n,deleteFrom:n.leftOuterWhitespace,deleteTo:l+f,insert:g,rangesArr:u,proposedReturn:[n.leftOuterWhitespace,l+f,g]}),U(),H(e,s,u)}else n={};k(e)||(n={})}A&&(A=!1)}if((!L||t[e]==="<"&&y(t,y(t,e))&&t[y(t,e)]==="/"&&t.startsWith("script",y(t,y(t,e))))&&T(e)&&!T(e-1)&&!`'"`.includes(t[e+1])&&(!`'"`.includes(t[e+2])||/\w/.test(t[e+1]))&&!(t[e+1]==="c"&&t[e+2]===":")&&!(t[e+1]==="f"&&t[e+2]==="m"&&t[e+3]==="t"&&t[e+4]===":")&&!(t[e+1]==="s"&&t[e+2]==="q"&&t[e+3]==="l"&&t[e+4]===":")&&!(t[e+1]==="x"&&t[e+2]===":")&&!(t[e+1]==="f"&&t[e+2]==="n"&&t[e+3]===":")&&_(n,t,e)){if(k(y(t,e)))continue;if(n.nameEnds&&n.nameEnds<e&&!n.lastClosingBracketAt&&(n.onlyPlausible===!0&&n.attributes&&n.attributes.length||n.onlyPlausible===!1)){let l=R(t,e,n.leftOuterWhitespace,e,n.lastOpeningBracketAt,e);s.cb({tag:n,deleteFrom:n.leftOuterWhitespace,deleteTo:e,insert:l,rangesArr:u,proposedReturn:[n.leftOuterWhitespace,e,l]}),H(e,s,u),n={},a={}}if(n.lastOpeningBracketAt!==void 0&&n.onlyPlausible&&n.name&&!n.quotes&&(n.lastOpeningBracketAt=void 0,n.name=void 0,n.onlyPlausible=!1),(n.lastOpeningBracketAt===void 0||!n.onlyPlausible)&&!n.quotes&&(n.lastOpeningBracketAt=e,n.slashPresent=!1,n.attributes=[],V===null?n.leftOuterWhitespace=e:s.trimOnlySpaces&&V===0?n.leftOuterWhitespace=w||e:n.leftOuterWhitespace=V,`${t[e+1]}${t[e+2]}${t[e+3]}`=="!--"||`${t[e+1]}${t[e+2]}${t[e+3]}${t[e+4]}${t[e+5]}${t[e+6]}${t[e+7]}${t[e+8]}`=="![CDATA[")){let l=!0;t[e+2]==="-"&&(l=!1);let i;for(let r=e;r<o;r++)if((!i&&l&&`${t[r-2]}${t[r-1]}${t[r]}`=="]]>"||!l&&`${t[r-2]}${t[r-1]}${t[r]}`=="-->")&&(i=r),i&&(i<r&&t[r].trim()||t[r+1]===void 0)){let $=r;(t[r+1]===void 0&&!t[r].trim()||t[r]===">")&&($+=1),(!p.length||p[p.length-1][0]!==n.lastOpeningBracketAt)&&p.push([n.lastOpeningBracketAt,i+1]),(!m.length||m[m.length-1][0]!==n.lastOpeningBracketAt)&&m.push([n.lastOpeningBracketAt,i+1]);let g=R(t,r,n.leftOuterWhitespace,$,n.lastOpeningBracketAt,i);s.cb({tag:n,deleteFrom:n.leftOuterWhitespace,deleteTo:$,insert:g,rangesArr:u,proposedReturn:[n.leftOuterWhitespace,$,g]}),e=r-1,t[r]===">"&&(e=r),n={},a={};break}}}t[e].trim()?V!==null&&(!n.quotes&&a.equalsAt>V-1&&a.nameEnds&&a.equalsAt>a.nameEnds&&t[e]!=='"'&&t[e]!=="'"&&(j(a)&&n.attributes.push(a),a={},n.equalsSpottedAt=void 0),V=null):V===null&&(V=e,n.lastOpeningBracketAt!==void 0&&n.lastOpeningBracketAt<e&&n.nameStarts&&n.nameStarts<n.lastOpeningBracketAt&&e===n.lastOpeningBracketAt+1&&!b.some(l=>l.name===n.name)&&(n.onlyPlausible=!0,n.name=void 0,n.nameStarts=void 0)),t[e]===" "?w===null&&(w=e):w!==null&&(w=null),n.name==="script"&&(L=!n.slashPresent)}if(t&&(s.trimOnlySpaces&&t[0]===" "||!s.trimOnlySpaces&&!t[0].trim()))for(let e=0,o=t.length;e<o;e++)if(s.trimOnlySpaces&&t[e]!==" "||!s.trimOnlySpaces&&t[e].trim()){u.push([0,e]);break}else t[e+1]||u.push([0,e+1]);if(t&&(s.trimOnlySpaces&&t[t.length-1]===" "||!s.trimOnlySpaces&&!t[t.length-1].trim())){for(let e=t.length;e--;)if(s.trimOnlySpaces&&t[e]!==" "||!s.trimOnlySpaces&&t[e].trim()){u.push([e+1,t.length]);break}}let O=u.current();if((!c||!c.cb)&&O){if(O[0]&&!O[0][0]){let e=O[0][1];u.ranges[0]=[u.ranges[0][0],u.ranges[0][1]]}if(O[O.length-1]&&O[O.length-1][1]===t.length){let e=O[O.length-1][0];if(u.ranges){let o=u.ranges[u.ranges.length-1][0];t[o-1]&&(s.trimOnlySpaces&&t[o-1]===" "||!s.trimOnlySpaces&&!t[o-1].trim())&&(o-=1);let l=u.ranges[u.ranges.length-1][2];u.ranges[u.ranges.length-1]=[o,u.ranges[u.ranges.length-1][1]],l?.trim()&&u.ranges[u.ranges.length-1].push(l.trimEnd())}}}return{log:{timeTakenInMilliseconds:Date.now()-D},result:re(t,u.current()),ranges:u.current(),allTagLocations:p,filteredTagLocations:m}}export{F as defaults,ge as stripHtml,De as version};
